---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: arma
  namespace: game-servers
spec:
  interval: 5m
  chart:
    spec:
      chart: arma-3-server
      version: 1.0.1
      sourceRef:
        kind: GitRepository
        name: arma-3-server
        #git: https://github.com/coolguy1771/k3s.git
        #ref: main
        #path: cluster/apps/game-servers/arma/
        namespace: game-servers
  values:
    image:
      repository: synixebrett/arma3server
      pullPolicy: Always
      tag: latest
    strategy:
      type: Recreate
    env:
      ARMA_BINARY: ./arma3server_x64
      ARMA_CONFIG: main.cfg
      ARMA_PROFILE: main
      STEAM_USER: "${SECRET_ARMA_STEAM_USERNAME}"
      STEAM_PASSWORD: "${SECRET_ARMA_STEAM_PASSWORD}"
    service:
      main:
        externalIP: 10.10.10.80
        type: LoadBalancer
        ports:
          arma:
            port: 2302
            enabled: true
            protocol: UDP
          steamquery:
            port: 2303
            enabled: true
            protocol: UDP
          steammaster:
            port: 2304
            enabled: ture
            protocol: UDP
          von:
            port: 2304
            enabled: ture
            protocol: UDP
          battleye:
            port: 2304
            enabled: ture
            protocol: UDP
    persistence:
      config:
        enabled: true
        storageClass: longhorn
        size: 100Gi
        mountPath: /arma3
    probes:
      liveness:
        enabled: false
      readiness:
        enabled: false
      startup:
        enabled: false