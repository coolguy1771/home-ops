---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: bitwardenrs
  namespace: default
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: bitwardenrs
      version: 2.1.10
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  values:
    replicaCount: 1
    image:
      repository: vaultwarden/server
      pullPolicy: IfNotPresent
      tag: "1.21.0"
    imagePullSecrets: []
    nameOverride: ""
    fullnameOverride: ""
    bitwardenrs:
      domain: "https://vault.witlinserver.com"
      signupsAllowed: true
      gui:
        # If you set a different port here, you must also provide it under env
        port: 80
      websockets:
        enabled: true
        port: 3012
      admin:
        enabled: true
        disableAdminToken: false
        existingSecret:
          enabled: false
          name: ""
          tokenKey: ""
      # Enable SMTP. https://github.com/dani-garcia/bitwarden_rs/wiki/SMTP-configuration
      smtp:
        enabled: true
        # SMTP hostname, required if SMTP is enabled
        host: "smtp.sendgrid.net"
        # SMTP sender e-mail address, required if SMTP is enabled
        from: "no-reply@witlinserver.com"
        # SMTP sender name, defaults to 'Bitwarden_RS'
        fromName: "Vaultwarden"
        # Enable SSL connection
        ssl: true
        # SMTP port
        port: 587
        # SMTP username
        user: "apikey"
        # SMTP password. Required is user is specified, ignored if no user provided
        password: "${SECRET_BITWARDEN_EMAIL_PASSWORD}"
        # Use existing secret for SMTP authentication
    env: {}
    persistence:
      type: statefulset
      enabled: true
      size: 5Gi
      accessMode: ReadWriteOnce
        ## Persistent Volume storage class
      # storageClass: "-"
        ## Use existing Persistent Volume Claim
      # existingClaim:
    serviceAccount:
        # Specifies whether a service account should be created
      create: true
    service:
      type: ClusterIP
      port: 80
        ## Provide any additional annotations which may be required. This can be used to
        ## set the LoadBalancer service type to internal only.
        ## ref: https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer
        ##
      annotations: {}
      labels: {}
      additionalSpec: {}
    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: nginx
      #  kubernetes.io/tls-acme: "true"
      hosts:
        - host: vault.witlinserver.com
          http:
            paths: []
      tls:
        - secretName: vault.witlinserver.com
          hosts:
            - vault.witlinserver.com
