---
# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-guardian
  namespace: xentra
spec:
  interval: 30m
  chart:
    spec:
      chart: kube-guardian
      version: 0.0.5
      sourceRef:
        kind: HelmRepository
        name: xentra
        namespace: flux-system
  maxHistory: 2
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    namespace:
      name: ""
      # -- Labels to add to the namespace
      labels: {}
      # -- Annotations to add to the namespace
      annotations: {}

    controller:
      image:
        repository: ghcr.io/xentra-ai/images/guardian-controller
        pullPolicy: Always
        tag: "latest"
        # -- Overrides the image tag.
    broker:
      # -- Number of broker replicas to deploy
      replicaCount: 1

      image:
        repository: ghcr.io/xentra-ai/images/guardian-broker
        pullPolicy: Always
        tag: "latest"
        # Overrides the image tag.
        sha: ""

      container:
        port: 9090

      imagePullSecrets: []
      nameOverride: ""
      fullnameOverride: ""

      serviceAccount:
        # Specifies whether a service account should be created
        create: true
        # Annotations to add to the service account
        annotations: {}
        # The name of the service account to use.
        # If not set and create is true, a name is generated using the fullname template
        name: ""
        # Automount API credentials for a service account
        automountServiceAccountToken: false

      podAnnotations: {}

      podSecurityContext: {}
        # fsGroup: 2000

      securityContext: {}
        # capabilities:
        #   drop:
        #   - ALL
        # readOnlyRootFilesystem: true
        # runAsNonRoot: true
        # runAsUser: 1000

      service:
        name: "broker"
        type: ClusterIP
        port: 9090

      resources: {}
        # We usually recommend not to specify default resources and to leave this as a conscious
        # choice for the user. This also increases chances charts run on environments with little
        # resources, such as Minikube. If you do want to specify resources, uncomment the following
        # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
        # limits:
        #   cpu: 100m
        #   memory: 128Mi
        # requests:
        #   cpu: 100m
        #   memory: 128Mi

      autoscaling:
        enabled: false
        minReplicas: 1
        maxReplicas: 100
        targetCPUUtilizationPercentage: 80
        # targetMemoryUtilizationPercentage: 80

      # -- Node labels for the kube-guardian broker pod assignment
      nodeSelector:
        kubernetes.io/arch: amd64

      # -- Tolerations for the kube-guardian broker pod assignment
      tolerations: []

      affinity: {}

      # Optional priority class to be used for the kube-guardian broker pods
      priorityClassName: ""

    database:
      name: guardian-db
      image:
        repository: postgres
        pullPolicy: Always
        tag: "latest"
        # Overrides the image tag.
        sha: ""

      persistence:
        enabled: false
        existingClaim: "guardian-db"

      container:
        port: 5432

      imagePullSecrets: []
      nameOverride: ""
      fullnameOverride: ""

      serviceAccount:
        # Specifies whether a service account should be created
        create: true
        # Annotations to add to the service account
        annotations: {}
        # The name of the service account to use.
        # If not set and create is true, a name is generated using the fullname template
        name: ""
        # Automount API credentials for a service account
        automountServiceAccountToken: false

      podAnnotations: {}

      podSecurityContext: {}
        # fsGroup: 2000

      securityContext: {}
        # capabilities:
        #   drop:
        #   - ALL
        # readOnlyRootFilesystem: true
        # runAsNonRoot: true
        # runAsUser: 1000

      service:
        name: "guardian-db"
        type: ClusterIP
        port: 80

      resources: {}
        # We usually recommend not to specify default resources and to leave this as a conscious
        # choice for the user. This also increases chances charts run on environments with little
        # resources, such as Minikube. If you do want to specify resources, uncomment the following
        # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
        # limits:
        #   cpu: 100m
        #   memory: 128Mi
        # requests:
        #   cpu: 100m
        #   memory: 128Mi

      autoscaling:
        enabled: false
        minReplicas: 1
        maxReplicas: 100
        targetCPUUtilizationPercentage: 80
        # targetMemoryUtilizationPercentage: 80

      # -- Node labels for the kube-guardian database pod assignment
      nodeSelector: {}

      # -- Tolerations for the kube-guardian database pod assignment
      tolerations: []

      affinity: {}

      # -- Priority class to be used for the kube-guardian database pods
      priorityClassName: ""
