---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vault-issuer
  namespace: cert-manager
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: vault-issuer
  namespace: cert-manager
rules:
  - apiGroups: ['']
    resources: ['serviceaccounts/token']
    resourceNames: ['vault-issuer']
    verbs: ['create']
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: vault-issuer
  namespace: cert-manager
subjects:
  - kind: ServiceAccount
    name: cert-manager
    namespace: cert-manager
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: vault-issuer
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: vault-issuer
  namespace: cert-manager
spec:
  vault:
    path: pki_int/sign/vault-issuer
    server: https://vault.vault-system.svc:8200
    caBundle: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBcyttSkJ3MWQyS2pDUkUvRWJnbWs3TTRUeHorRDJtUFFWN2MzQ0NTaHk3Vi9ZMnVkClRhbGNTM3ptSGY1NVE5T2U2bHBMc3JLZXdnSFNObFV5N1FCWTB2M1lOOXN1SHdsTUhXcEs4NmhDOUx2ekxKeG8KWnpySVZrQVB6eU9GelV1Y3B0aVFHeS9keW9TNzNFNXd4Nk9BdzhaTDBteWVEYXpvTmFkL1JKdk5LcUZ1cTVUQgpmMmtnQ0RrbVoyZUc4RzJBa3lWc294NTJjM0ZuQURIMzN6bnZ2SUpmL2JuSU9RVUI4OUx5UHEzQjlwa3ByKzN5CmM1V2xtM25OUlhYNHA4TkUycEVqVXgweUVnaFRYZHRYRUkxNUhGS0N1QldrNStpZDJPTG1keGlhMndRUWVZbDUKNlJLblRJWTRMRHA5TTFsOTRXcWxzQnlaTmxxZk9rZHRpMXhuOXdJREFRQUJBb0lCQUYxcDZJZ00zS2xlRm1BNQp1cGdYMGRaU3VkbytsRXVVZjl6TGVIdDE2YnhIcExrT2EwS2pxUlJZNlhLeGFtMVpONjRlN0NjQXI0VzBSRjJKCnAwTi9acDlHeGpsYVNIdzg2NVJxV0RoaktVREJSZVhuNEIyWlcrUE1wMmk1M1FOWE95TTJWcnlIQWZYaExWbWEKTU55M2ZHZ3FVYndVUVl5QU5xR0ZNb09CRWVvTHY4RjY4eEwyNE13WTRZcTVkb2s2bnA3SzZWelVqdVdJSk41aQp5L2JpMXpia0haVFN5ZlBLbHNYbGR5VHRGcllaT0xQRlY5bGZ3a3JwTlhEai80eE81REx2ck8rS29rRnNrNGIrCmlxRUkwUGdlWTVzVm9kc3JuTTRyb21lZ2kxTVhKaUp2eVUxckIyaTZ1SGpjMGdETHFIQUs0OWlxZ0VlandQRFAKOW9icEZTRUNnWUVBN2tjekNZNDN3ZjFFS05pSTRIQ1JQNlVwRE8yeTJsZTFWZmRNdnJxUGVuOWlBdFcrZkJpRAp5aG5wdkJyRTdudVo0NGZqSkZzSHlTLzB4TDI1TCtWTWpWcC9VU2UyM1RURUIwRUFYR1lMRlBONU9xRmZEcHQwCjlLeHFKMGsvejFUbXlrZkRvYUsrZFlxc3RvUWhYS2dEZEVJa1ZhcWRJbmZoeTRwdEJTQm9lTTBDZ1lFQXdVc04Kb29nZnZCYzQ1ZEZhTThQa1FteDBZZzdQMGpNWUN0aS8xSWUxNEtDTzYramZ4WWhDeVVsUUh3cUNaSWpBQnlKdAo5c0xTa01iTGljc2F3c3lHeUZhcHE2Z1Q1TVNaYy9WNmRZblZLV0dVSVZrZWJqVjYybXdkWVdwUHN5YkM5TSszClFISjQvZUVDZzVYeFF6cXN1ZEZ4ekRBZk1JMG1SeDV3Q05ud005TUNnWUFMNndmRWZKYVJYMmVmVzJWTlJKUWYKU05XS3pnRGFKdlRzL2RlYTJwMytsSXlFYzhoNVVJaVcvVURScGMwZjJKTFQ3S0lSMlhQRVBsL1J6Mk9KMzhBNgplY0pRZnRvSXFuRDdvK2F1dUhQcGNsd244SlplbHF2ODZQck9TRDJtMHlwUUI5TGpMTTYxOWwrNUtWYTUyYldDCmhTUm9ISWFMaU0rRWJNSVROWkhFS1FLQmdHR2VUL0tIb005VFF3NzkzZnBLc2xyQmZ6Mk9rWEp0RDNWYTVmYWwKMnpyb200V1ZCSDQwUk5aM1NobURLenN1dlJ4ZFRQL1VnSmRSYnJYV2QxdHVBNXZsK0thU3FnbGRLTXFoYlFregpaUTRURThhTHhZeVBRYzVSejd6RS9oOVNNaCtGVDkwaWN1eDAyTm92dmJyZ1JSOUxJWmVucmZqTk1FbTJtNG84CjFzeTFBb0dBZXZYMTNUa2RYUUoxYmE4TTZuVE0zK2VpaXVvUnc5RFlBTmRXRVB4d0VhR21yVUhQYTc0bTJoZEEKWmRtNE9ld2wzYUhhcmlLWS9CMzdUWUlWcU1CQzYrTTREOGN3emwybnovRENidjAvTE1oMm9FZVVuT1lQOXpnTgpISHl0WnNjaThiMjc1OUVFZWdmYzhIRlZnRFdPN0xGMXcvYTZSczNjSER4Y08rWDl5VzQ9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJQ2xUQ0NBanVnQXdJQkFnSVFmU0MzWnRMZ1pBbk9YSktEUmFKY1NUQUtCZ2dxaGtqT1BRUURBakFZTVJZdwpGQVlEVlFRREV3MXpaV3htYzJsbmJtVmtMV05oTUI0WERUSXpNVEV4TlRBek1URTFORm9YRFRJME1ESXhNekF6Ck1URTFORm93RWpFUU1BNEdBMVVFQ2hNSGFHOXRaV3hoWWpDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVAKQURDQ0FRb0NnZ0VCQUxQcGlRY05YZGlvd2tSUHhHNEpwT3pPRThjL2c5cGowRmUzTndna29jdTFmMk5yblUycApYRXQ4NWgzK2VVUFRudXBhUzdLeW5zSUIwalpWTXUwQVdOTDkyRGZiTGg4SlRCMXFTdk9vUXZTNzh5eWNhR2M2CnlGWkFEODhqaGMxTG5LYllrQnN2M2NxRXU5eE9jTWVqZ01QR1M5SnNuZzJzNkRXbmYwU2J6U3FoYnF1VXdYOXAKSUFnNUptZG5odkJ0Z0pNbGJLTWVkbk54WndBeDk5ODU3N3lDWC8yNXlEa0ZBZlBTOGo2dHdmYVpLYS90OG5PVgpwWnQ1elVWMStLZkRSTnFSSTFNZE1oSUlVMTNiVnhDTmVSeFNncmdWcE9mb25kamk1bmNZbXRzRUVIbUplZWtTCnAweUdPQ3c2ZlROWmZlRnFwYkFjbVRaYW56cEhiWXRjWi9jQ0F3RUFBYU9Cb1RDQm5qQWRCZ05WSFNVRUZqQVUKQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JUOAo5NGVqVHFBUkFIVGtEUFp1Yk9tY3JSeTdJREJPQmdOVkhSRUVSekJGZ2lBcUxuWmhkV3gwTFhONWMzUmxiUzV6CmRtTXVZMngxYzNSbGNpNXNiMk5oYklJU0tpNTJZWFZzZEMxemVYTjBaVzB1YzNaamdnMTJZWFZzZEM0eU9EWnIKTG1Odk1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lDTk9ZaUdWazNBRTlvOUFNM05YSDlmaWxKaU5vSURTdzNydgpad1h1S2RYcEFpRUFyeG9hWUdscUlRMk50NGFZajBLbTV2U1FkaHhmNk50c0tlTmgrek1aRUI0PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    auth:
      kubernetes:
        role: vault-issuer
        mountPath: /v1/auth/kubernetes
        serviceAccountRef:
          name: vault-issuer
